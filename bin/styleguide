#!/bin/bash

usage() {
    echo "Usage: $0 -s <source_path> -o <output_path> [-m <markdown_file>] [--server]" 1>&2; exit 1;
}

# Prefix to allo executing in bin directory
if [[ `pwd` == *bin ]]
    then
        echo "Need to run in project root, not in bin" 1>&2; exit 1;
fi

TEMP=`getopt -o s:o:m: --long server:: -- "$@"`

if [ $? != 0 ] ; then usage >&2 ; exit 1 ; fi

# Note the quotes around `$TEMP': they are essential!
eval set -- "$TEMP"

while true ; do
    case "$1" in
        -s) s=$2 ; shift 2 ;;
        -o) o=$2 ; shift 2 ;;
        -m) m=$2 ; shift 2 ;;
        --server) server='--server'; shift 2 ;;
        --) shift ; break ;;
        *) usage ; exit 1 ;;
    esac
done

# Validate parameters
if [ ${#s} -lt 1 ]; then
    usage
fi

if [ ${#o} -lt 1 ]; then
    usage
fi

# echo "Source = ${s}"
# echo "Output = ${o}"
# echo "$server"

# Execute
if [ ${#m} -lt 1 ]; then
    /usr/bin/env node node_modules/gulp/bin/gulp.js styleguide --source ${s} --output ${o}
else
    # echo "Markdown = ${m}"
    /usr/bin/env node node_modules/gulp/bin/gulp.js styleguide --source ${s} --output ${o} --markdown ${m}
fi

if [ $server ]; then
    /usr/bin/env node node_modules/gulp/bin/gulp.js serve
fi

