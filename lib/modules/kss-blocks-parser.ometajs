ometa kssBlocksParser {

  lineBreak = seq('\n'),
  lineEnd = lineBreak | end,

  inlineCommentPrefix = seq('//'),
  lineWithNoComments = (~inlineCommentPrefix char)* lineEnd,

  kssReferenceNumber_ = '.' digit+ kssReferenceNumber_*,
  kssReferenceNumber = digit+ kssReferenceNumber_*,

  kssReferenceString = seq(' ')* seq('Styleguide ') kssReferenceNumber seq(' ')*,

  inlineComment = inlineCommentPrefix (~lineEnd ~kssReferenceString char)*,

  kssLastString = inlineCommentPrefix kssReferenceString lineEnd,

  kssMarkup = ((~lineWithNoComments inlineComment lineEnd)* kssLastString):k -> [#kss, k],

  code = (~kssMarkup char)*:c -> [#code, c.join('')],

  block = kssMarkup:k lineEnd* code:c -> [#block, k, c],

  any = code? (block)*

}
